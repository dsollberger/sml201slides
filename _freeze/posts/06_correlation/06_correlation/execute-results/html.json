{
  "hash": "7cb445248ce572a06822c3686549a090",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"6: Correlation and Paradoxes\"\nauthor: \"Derek Sollberger\"\ndate: \"2026-02-12\"\nformat:\n  html:\n    toc: true\n---\n\n\n\n\n# SML 201\n\n## Start\n\n:::: {.columns}\n\n::: {.column width=\"30%\"}\n* **Goal**: Explore covariance\n\n* **Objective**: Compute interquartile ranges and correlations\n:::\n\n::: {.column width=\"10%\"}\n\n:::\n\n::: {.column width=\"60%\"}\n![correlation](xkcd552.png)\n\n* image source: [XKCD](https://xkcd.com/552/)\n:::\n\n::::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"corrplot\")  # plots correlation matrices\nlibrary(\"ggsignif\")  # significance levels in boxplots\nlibrary(\"gt\")        # great tables\nlibrary(\"patchwork\") # arrange plots side-by-side\nlibrary(\"tidyverse\") # data wrangling and visualization\n\ncorrelatedValues = function(x, r = 0.9){\n  r2 = r**2\n  ve = 1-r2\n  SD = sqrt(ve)\n  e  = rnorm(length(x), mean=0, sd=SD)\n  y  = r*x + e\n  return(y)\n}\n```\n:::\n\n\n\n## Data\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n* Coffee Ratings\n* source: [Coffee Quality Database](https://github.com/jldbc/coffee-quality-database)\n* host: [TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-07-07/readme.md) --- July 7, 2020\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# coffee_df <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-07/coffee_ratings.csv')\ncoffee_df <- readr::read_csv(\"coffee_ratings.csv\")\n```\n:::\n\n:::\n\n::::\n\n\n## Glance\n\n::::: {.panel-tabset}\n\n### head\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(coffee_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 43\n  total_cup_points species owner    country_of_origin farm_name lot_number mill \n             <dbl> <chr>   <chr>    <chr>             <chr>     <chr>      <chr>\n1             90.6 Arabica metad p… Ethiopia          \"metad p… <NA>       meta…\n2             89.9 Arabica metad p… Ethiopia          \"metad p… <NA>       meta…\n3             89.8 Arabica grounds… Guatemala         \"san mar… <NA>       <NA> \n4             89   Arabica yidneka… Ethiopia          \"yidneka… <NA>       wole…\n5             88.8 Arabica metad p… Ethiopia          \"metad p… <NA>       meta…\n6             88.8 Arabica ji-ae a… Brazil             <NA>     <NA>       <NA> \n# ℹ 36 more variables: ico_number <chr>, company <chr>, altitude <chr>,\n#   region <chr>, producer <chr>, number_of_bags <dbl>, bag_weight <chr>,\n#   in_country_partner <chr>, harvest_year <chr>, grading_date <chr>,\n#   owner_1 <chr>, variety <chr>, processing_method <chr>, aroma <dbl>,\n#   flavor <dbl>, aftertaste <dbl>, acidity <dbl>, body <dbl>, balance <dbl>,\n#   uniformity <dbl>, clean_cup <dbl>, sweetness <dbl>, cupper_points <dbl>,\n#   moisture <dbl>, category_one_defects <dbl>, quakers <dbl>, color <chr>, …\n```\n\n\n:::\n:::\n\n\n\n### structure\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(coffee_df, give.attr = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspc_tbl_ [1,339 × 43] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ total_cup_points     : num [1:1339] 90.6 89.9 89.8 89 88.8 ...\n $ species              : chr [1:1339] \"Arabica\" \"Arabica\" \"Arabica\" \"Arabica\" ...\n $ owner                : chr [1:1339] \"metad plc\" \"metad plc\" \"grounds for health admin\" \"yidnekachew dabessa\" ...\n $ country_of_origin    : chr [1:1339] \"Ethiopia\" \"Ethiopia\" \"Guatemala\" \"Ethiopia\" ...\n $ farm_name            : chr [1:1339] \"metad plc\" \"metad plc\" \"san marcos barrancas \\\"san cristobal cuch\" \"yidnekachew dabessa coffee plantation\" ...\n $ lot_number           : chr [1:1339] NA NA NA NA ...\n $ mill                 : chr [1:1339] \"metad plc\" \"metad plc\" NA \"wolensu\" ...\n $ ico_number           : chr [1:1339] \"2014/2015\" \"2014/2015\" NA NA ...\n $ company              : chr [1:1339] \"metad agricultural developmet plc\" \"metad agricultural developmet plc\" NA \"yidnekachew debessa coffee plantation\" ...\n $ altitude             : chr [1:1339] \"1950-2200\" \"1950-2200\" \"1600 - 1800 m\" \"1800-2200\" ...\n $ region               : chr [1:1339] \"guji-hambela\" \"guji-hambela\" NA \"oromia\" ...\n $ producer             : chr [1:1339] \"METAD PLC\" \"METAD PLC\" NA \"Yidnekachew Dabessa Coffee Plantation\" ...\n $ number_of_bags       : num [1:1339] 300 300 5 320 300 100 100 300 300 50 ...\n $ bag_weight           : chr [1:1339] \"60 kg\" \"60 kg\" \"1\" \"60 kg\" ...\n $ in_country_partner   : chr [1:1339] \"METAD Agricultural Development plc\" \"METAD Agricultural Development plc\" \"Specialty Coffee Association\" \"METAD Agricultural Development plc\" ...\n $ harvest_year         : chr [1:1339] \"2014\" \"2014\" NA \"2014\" ...\n $ grading_date         : chr [1:1339] \"April 4th, 2015\" \"April 4th, 2015\" \"May 31st, 2010\" \"March 26th, 2015\" ...\n $ owner_1              : chr [1:1339] \"metad plc\" \"metad plc\" \"Grounds for Health Admin\" \"Yidnekachew Dabessa\" ...\n $ variety              : chr [1:1339] NA \"Other\" \"Bourbon\" NA ...\n $ processing_method    : chr [1:1339] \"Washed / Wet\" \"Washed / Wet\" NA \"Natural / Dry\" ...\n $ aroma                : num [1:1339] 8.67 8.75 8.42 8.17 8.25 8.58 8.42 8.25 8.67 8.08 ...\n $ flavor               : num [1:1339] 8.83 8.67 8.5 8.58 8.5 8.42 8.5 8.33 8.67 8.58 ...\n $ aftertaste           : num [1:1339] 8.67 8.5 8.42 8.42 8.25 8.42 8.33 8.5 8.58 8.5 ...\n $ acidity              : num [1:1339] 8.75 8.58 8.42 8.42 8.5 8.5 8.5 8.42 8.42 8.5 ...\n $ body                 : num [1:1339] 8.5 8.42 8.33 8.5 8.42 8.25 8.25 8.33 8.33 7.67 ...\n $ balance              : num [1:1339] 8.42 8.42 8.42 8.25 8.33 8.33 8.25 8.5 8.42 8.42 ...\n $ uniformity           : num [1:1339] 10 10 10 10 10 10 10 10 9.33 10 ...\n $ clean_cup            : num [1:1339] 10 10 10 10 10 10 10 10 10 10 ...\n $ sweetness            : num [1:1339] 10 10 10 10 10 10 10 9.33 9.33 10 ...\n $ cupper_points        : num [1:1339] 8.75 8.58 9.25 8.67 8.58 8.33 8.5 9 8.67 8.5 ...\n $ moisture             : num [1:1339] 0.12 0.12 0 0.11 0.12 0.11 0.11 0.03 0.03 0.1 ...\n $ category_one_defects : num [1:1339] 0 0 0 0 0 0 0 0 0 0 ...\n $ quakers              : num [1:1339] 0 0 0 0 0 0 0 0 0 0 ...\n $ color                : chr [1:1339] \"Green\" \"Green\" NA \"Green\" ...\n $ category_two_defects : num [1:1339] 0 1 0 2 2 1 0 0 0 4 ...\n $ expiration           : chr [1:1339] \"April 3rd, 2016\" \"April 3rd, 2016\" \"May 31st, 2011\" \"March 25th, 2016\" ...\n $ certification_body   : chr [1:1339] \"METAD Agricultural Development plc\" \"METAD Agricultural Development plc\" \"Specialty Coffee Association\" \"METAD Agricultural Development plc\" ...\n $ certification_address: chr [1:1339] \"309fcf77415a3661ae83e027f7e5f05dad786e44\" \"309fcf77415a3661ae83e027f7e5f05dad786e44\" \"36d0d00a3724338ba7937c52a378d085f2172daa\" \"309fcf77415a3661ae83e027f7e5f05dad786e44\" ...\n $ certification_contact: chr [1:1339] \"19fef5a731de2db57d16da10287413f5f99bc2dd\" \"19fef5a731de2db57d16da10287413f5f99bc2dd\" \"0878a7d4b9d35ddbf0fe2ce69a2062cceb45a660\" \"19fef5a731de2db57d16da10287413f5f99bc2dd\" ...\n $ unit_of_measurement  : chr [1:1339] \"m\" \"m\" \"m\" \"m\" ...\n $ altitude_low_meters  : num [1:1339] 1950 1950 1600 1800 1950 ...\n $ altitude_high_meters : num [1:1339] 2200 2200 1800 2200 2200 NA NA 1700 1700 1850 ...\n $ altitude_mean_meters : num [1:1339] 2075 2075 1700 2000 2075 ...\n```\n\n\n:::\n:::\n\n\n### colnames\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(coffee_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"total_cup_points\"      \"species\"               \"owner\"                \n [4] \"country_of_origin\"     \"farm_name\"             \"lot_number\"           \n [7] \"mill\"                  \"ico_number\"            \"company\"              \n[10] \"altitude\"              \"region\"                \"producer\"             \n[13] \"number_of_bags\"        \"bag_weight\"            \"in_country_partner\"   \n[16] \"harvest_year\"          \"grading_date\"          \"owner_1\"              \n[19] \"variety\"               \"processing_method\"     \"aroma\"                \n[22] \"flavor\"                \"aftertaste\"            \"acidity\"              \n[25] \"body\"                  \"balance\"               \"uniformity\"           \n[28] \"clean_cup\"             \"sweetness\"             \"cupper_points\"        \n[31] \"moisture\"              \"category_one_defects\"  \"quakers\"              \n[34] \"color\"                 \"category_two_defects\"  \"expiration\"           \n[37] \"certification_body\"    \"certification_address\" \"certification_contact\"\n[40] \"unit_of_measurement\"   \"altitude_low_meters\"   \"altitude_high_meters\" \n[43] \"altitude_mean_meters\" \n```\n\n\n:::\n:::\n\n\n:::::\n\n\n# Scatterplots\n\n::: {.callout-note}\n## Scatterplots\n\nA **scatterplot** helps us visualize two numerical variables.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  filter(total_cup_points > 0) |>\n  ggplot(aes(x = acidity, y = body)) +\n  geom_point() +\n  labs(title = \"Coffee Ratings\",\n       subtitle = \"Do the data vary together?\",\n       caption = \"Source: Coffee Quality Database\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Covariance\n\n:::: {.panel-tabset}\n\n## Formula\n\nFor data $(X,Y)$ listed as $n$ data points $(x_{i}, y_{i})$, the **covariance** is defined as\n\n$$\\begin{array}{rcl}\n  \\text{Cov}(X,Y) & = & \\frac{1}{2n^{2}}\\sum_{i=1}^{n}\\sum_{j=1}^{n}(x_{i} - x_{j})(y_{i} - y_{j}) \\\\\n  ~ & = & \\text{E}[X] \\cdot \\text{E}[Y] - \\text{E}[XY] \\\\\n  \\end{array}$$\n\n## Intuition\n\n![constructive or destructive waves](constructive_destructive_waves.png)\n\n* image source: [Fissics](https://www.fizzics.org/interference-of-waves/)\n\n## Commentary\n\n* Are resultant numbers large or small?\n* Units? (e.g. \"hot-dog-fries\")\n\n::::\n\n## Standardization\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n### z-score\n\n$$\\begin{array}{ccc}\nz & = & \\frac{x - \\bar{x}}{s} \\\\\n~ & = & \\frac{\\text{deviation}}{\\text{standard deviation}} \\\\\n\\end{array}$$\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n### Correlation\n\n$$\\begin{array}{ccc}\n  r & = & \\frac{\\sum_{i=1}^{n} (x_{i} - \\bar{x})(y_{i} - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_{i} - \\bar{x})}\\sqrt{\\sum_{i=1}^{n} (y_{i} - \\bar{y})}} \\\\\n  ~ & = & \\frac{\\text{Cov}(X,Y)}{\\text{SD}(X) \\cdot \\text{SD}(Y)} \\\\\n  ~ & = & \\frac{1}{n-1}\\sum_{i=1}^{n}\\left(\\frac{x_{i}-\\bar{x}}{s_{x}}\\right)\\left(\\frac{y_{i}-\\bar{y}}{s_{y}}\\right) \\\\\n\\end{array}$$\n:::\n\n::::\n\n::: {.callout-tip}\n## Claim: Range of Correlation\n\nThe *correlation coefficient* $r$ has a mathematical range in $[-1,1]$:\n\n$$-1 \\leq r \\leq 1$$\n:::\n\n\n\n::: {.callout-note collapse=\"true\"}\n## (optional) Outline of Proof\n\n1. Show that $\\text{Corr}(X,Y) \\geq -1$ by starting with\n\n$$0 \\leq \\text{Var}\\left( \\frac{X}{\\sqrt{\\text{Var}(X)}} + \\frac{Y}{\\sqrt{\\text{Var}(Y)}} \\right)$$\n\n2. Replace $X$ with $-X$ in the previous part to show that $\\text{Corr}(X,Y) \\leq 1$\n3. Combine the above results\n:::\n\n\n# Correlation (Concept)\n\n:::: {.columns}\n\n::: {.column width=\"60%\"}\nIn this course, we will simply follow the Pearson suggestions for interpreting correlation values:\n\n* $-1.0 \\leq r \\leq -0.7$: highly and negatively correlated\n* $-0.7 < r < -0.4$: slightly and negatively correlated\n* $-0.4 \\leq r \\leq 0.4$: virtually uncorrelated\n* $0.4 < r < 0.7$: slightly and positively correlated\n* $0.7 \\leq r \\leq 1.0$: highly and positively correlated\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"30%\"}\n![Karl Pearson](Karl_Pearson.png)\n:::\n\n::::\n\n## Demonstration\n\n::: {.panel-tabset}\n\n### 1\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### 2\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### 3\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### 4\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### 5\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n:::\n\n::: {.callout-warning}\n# DCP 1\n:::\n\n# Correlation (Calculations)\n\n## What is piping?\n\n::: {.callout-warning}\n### Step-by-Step\n\nEarly in learning computer programming, we could create a new data frame after each calculation, but\n\n* prone to typos and other errors\n* more needs on computer memory\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df2 <- select(coffee_df, flavor, aftertaste)\ncoffee_df3 <- mutate(coffee_df2, scale_x = scale(flavor))\ncoffee_df4 <- mutate(coffee_df3, scale_y = scale(aftertaste))\ncovariance_ops <- mutate(coffee_df4, products = scale_x * scale_y)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncovariance_ops <- coffee_df |>\n  select(flavor, aftertaste) |>\n  mutate(scale_x = scale(flavor)) |>\n  mutate(scale_y = scale(aftertaste)) |>\n  mutate(products = scale_x * scale_y)\n```\n:::\n\n\n::: {.callout-warning}\n### Piping for Efficiency\n\nPiping in `R` allows us to code processes naturally \n\n* as a chain of thought\n* removes temporary data frames afterward\n:::\n\n## Long Way\n\n::: {.callout-note}\n### Long Way Digressions\n\nThese \"Long Way\" digressions are here to show more R functions, reveal internal calculations, and/or preview future ideas.\n:::\n\n### Scatterplots\n\n::::: {.panel-tabset}\n\n#### plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n#### code\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- coffee_df |>\n  filter(total_cup_points > 0) |> #avoids outliers\n  ggplot() +\n  geom_point(aes(x = flavor, y = aftertaste),\n             color = \"brown\") +\n  labs(title = \"Aftertaste vs Flavor\",\n       subtitle = \"Coffee Ratings Data\",\n       caption = \"Source: Tidy Tuesday\") +\n  theme_minimal()\n\np2 <- coffee_df |>\n  filter(total_cup_points > 0) |> #avoids outliers\n  mutate(scale_x = scale(flavor)) |>\n  mutate(scale_y = scale(aftertaste)) |>\n  ggplot() +\n  geom_point(aes(x = scale_x, y = scale_y),\n             color = \"brown\") +\n  labs(title = \"Aftertaste vs Flavor\",\n       subtitle = \"Standardized Data\",\n       caption = \"Source: Tidy Tuesday\") +\n  theme_minimal()\n\np1 + p2 #patchwork\n```\n:::\n\n\n:::::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncovariance_ops <- coffee_df |>\n  select(flavor, aftertaste) |>\n  mutate(scale_x = scale(flavor)) |>\n  mutate(scale_y = scale(aftertaste)) |>\n  mutate(products = scale_x * scale_y)\n```\n:::\n\n\n### gt\n\n::::: {.panel-tabset}\n\n#### table\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"fsyscjollx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fsyscjollx table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fsyscjollx thead, #fsyscjollx tbody, #fsyscjollx tfoot, #fsyscjollx tr, #fsyscjollx td, #fsyscjollx th {\n  border-style: none;\n}\n\n#fsyscjollx p {\n  margin: 0;\n  padding: 0;\n}\n\n#fsyscjollx .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fsyscjollx .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fsyscjollx .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fsyscjollx .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fsyscjollx .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fsyscjollx .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fsyscjollx .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fsyscjollx .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fsyscjollx .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fsyscjollx .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fsyscjollx .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fsyscjollx .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fsyscjollx .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fsyscjollx .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fsyscjollx .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsyscjollx .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fsyscjollx .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fsyscjollx .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fsyscjollx .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsyscjollx .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fsyscjollx .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsyscjollx .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fsyscjollx .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsyscjollx .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fsyscjollx .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsyscjollx .gt_left {\n  text-align: left;\n}\n\n#fsyscjollx .gt_center {\n  text-align: center;\n}\n\n#fsyscjollx .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fsyscjollx .gt_font_normal {\n  font-weight: normal;\n}\n\n#fsyscjollx .gt_font_bold {\n  font-weight: bold;\n}\n\n#fsyscjollx .gt_font_italic {\n  font-style: italic;\n}\n\n#fsyscjollx .gt_super {\n  font-size: 65%;\n}\n\n#fsyscjollx .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fsyscjollx .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fsyscjollx .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fsyscjollx .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fsyscjollx .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fsyscjollx .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fsyscjollx .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#fsyscjollx .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#fsyscjollx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\" style>Correlation Internal Calculations</td>\n    </tr>\n    <tr class=\"gt_heading\">\n      <td colspan=\"5\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Rescaled Data and Products (first 10 rows shown)</td>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"flavor\">flavor</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"aftertaste\">aftertaste</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"scale_x\">scale_x</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"scale_y\">scale_y</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"products\">products</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.83</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.67</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">3.29</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">3.14</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">10.31</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.67</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.89</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.72</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">7.84</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.42</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.46</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.52</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">6.19</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.58</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.42</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.66</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.52</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">6.70</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.25</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.46</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.10</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">5.16</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.42</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.42</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.26</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.52</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">5.69</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.33</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.46</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.30</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">5.65</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.33</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.03</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.72</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">5.52</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.67</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.58</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.89</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.91</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">8.41</td></tr>\n    <tr><td headers=\"flavor\" class=\"gt_row gt_center\">8.58</td>\n<td headers=\"aftertaste\" class=\"gt_row gt_center\">8.50</td>\n<td headers=\"scale_x\" class=\"gt_row gt_center\" style=\"background-color: #BFEFFF;\">2.66</td>\n<td headers=\"scale_y\" class=\"gt_row gt_center\" style=\"background-color: #FF6A6A;\">2.72</td>\n<td headers=\"products\" class=\"gt_row gt_center\" style=\"background-color: #E066FF;\">7.23</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"5\"> Source: Tidy Tuesday</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n#### code\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncovariance_ops |>\n  slice(1:10) |> #for visual brevity\n  gt() |>\n  cols_align(align = \"center\") |>\n  fmt_number(columns = everything(), decimals = 2) |>\n  tab_footnote(footnote = \"Source: Tidy Tuesday\") |>\n  tab_header(\n    title = \"Correlation Internal Calculations\",\n    subtitle = \"Rescaled Data and Products (first 10 rows shown)\"\n  ) |>\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_column_labels()\n  ) |>\n  tab_style(\n    style = list(cell_fill(color = \"lightblue1\")),\n    locations = cells_body(columns = \"scale_x\")\n  ) |>\n  tab_style(\n    style = list(cell_fill(color = \"indianred1\")),\n    locations = cells_body(columns = \"scale_y\")\n  ) |>\n  tab_style(\n    style = list(cell_fill(color = \"mediumorchid1\")),\n    locations = cells_body(columns = \"products\")\n  )\n```\n:::\n\n\n:::::\n\n### Finish\n\n$$r = \\frac{1}{n-1}\\sum_{i=1}^{n}\\left(\\frac{x_{i}-\\bar{x}}{s_{x}}\\right)\\left(\\frac{y_{i}-\\bar{y}}{s_{y}}\\right)$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# sample size\n# (carefully calculated in case of missing values)\nn <- sum(!is.na(coffee_df$flavor))\n\ncorr_val <- sum(covariance_ops$products) / (n - 1)\nprint(round(corr_val, 4))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8957\n```\n\n\n:::\n:::\n\n\n* The data for `flavor` and `aftertaste` are strongly and positively correlated\n\n\n\n\n\n\n\n\n## Short Way\n\n::: {.callout-note}\n### Short Way Tools\n\nYou may use code in the \"Short Way\" in precepts and projects (unless otherwise instructed)\n:::\n\n* Compute the correlation between `flavor` and `aftertaste`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(coffee_df$flavor, coffee_df$aftertaste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8956718\n```\n\n\n:::\n:::\n\n\n* Compute the correlation between `uniformity` and `clean_cup`\n\n::: {.callout-note}\n### Missing Values\n\nDerek recommends using `use = \"pairwise.complete.obs\"` to avoid missing values in the `cor()` calculation(s).\n\n*  See: Precept 4\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(coffee_df$uniformity, coffee_df$clean_cup,\n    use = \"pairwise.complete.obs\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.5262187\n```\n\n\n:::\n:::\n\n\n* Compute the correlation between `aroma` and `sweetness`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  summarize(r = cor(aroma, sweetness,\n                    use = \"pairwise.complete.obs\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n      r\n  <dbl>\n1 0.253\n```\n\n\n:::\n:::\n\n\n\n# Data Ethics: Causation?\n\n::: {.callout-warning}\n# DCP 2\n:::\n\n::: {.callout-warning}\n## Correlation is Not Causation\n\n* High values of $r$ can appear by coincidence\n* Even if there was some causation, how would we show the direction?\n* Popular website of examples: [Spurious Correlations](https://tylervigen.com/spurious-correlations) by Tyler Vigen\n\n:::\n\n# Paradoxes\n\n## Simpson's Paradox\n\n::: {.callout-note collapse=\"true\"}\n### demonstration code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx1 = rnorm(100, mean = -6, sd = 1)\ny1 = correlatedValues(x1, r = 0.75) + 6\nx2 = rnorm(100, mean = -3, sd = 1)\ny2 = correlatedValues(x2, r = 0.75) + 3\nx3 = rnorm(100, mean = 0, sd = 1)\ny3 = correlatedValues(x3, r = 0.75)\nx4 = rnorm(100, mean = 3, sd = 1)\ny4 = correlatedValues(x4, r = 0.75) - 3\nx5 = rnorm(100, mean = 6, sd = 1)\ny5 = correlatedValues(x5, r = 0.75) - 6\n\ndf1 <- data.frame(x1, y1, \"group 1\")\ndf2 <- data.frame(x2, y2, \"group 2\")\ndf3 <- data.frame(x3, y3, \"group 3\")\ndf4 <- data.frame(x4, y4, \"group 4\")\ndf5 <- data.frame(x5, y5, \"group 5\")\nnames(df1) <- c(\"xdata\", \"ydata\", \"group\")\nnames(df2) <- c(\"xdata\", \"ydata\", \"group\")\nnames(df3) <- c(\"xdata\", \"ydata\", \"group\")\nnames(df4) <- c(\"xdata\", \"ydata\", \"group\")\nnames(df5) <- c(\"xdata\", \"ydata\", \"group\")\ndemo_df <- rbind(df1, df2, df3, df4, df5)\n```\n:::\n\n:::\n\n\n\nNow we will visualize the data in `demo_df`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemo_df |>\nggplot(aes(x = xdata, y = ydata)) +\n  geom_point() +\n  labs(title = \"all together\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# compute correlation\ndemo_df |>\n  summarize(cor = cor(xdata, ydata))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         cor\n1 -0.6190699\n```\n\n\n:::\n:::\n\n\nNow let us treat the groups separately.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemo_df |>\nggplot(aes(x = xdata, y = ydata, color = group)) +\n  geom_point() +\n  labs(title = \"separate groups\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# compute correlation\ndemo_df |>\n  group_by(group) |>\n  summarize(cor = cor(xdata, ydata))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  group     cor\n  <chr>   <dbl>\n1 group 1 0.783\n2 group 2 0.701\n3 group 3 0.825\n4 group 4 0.673\n5 group 5 0.700\n```\n\n\n:::\n:::\n\n\n\n## Berkson's Paradox\n\n### College Admission Stats\n\n\n::: {.cell}\n\n:::\n\n\n::::: {.panel-tabset}\n\n#### overall\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n#### subset\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n#### bias\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n#### code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx1 = rnorm(1000, mean = 0, sd = 1)\ny1 = correlatedValues(x1, r = 0.75)\ngpa_hs <- 0.5*x1 + 3\nsat_hs <- 200*y1 + 1200\ndata_hs <- data.frame(gpa_hs, sat_hs) |>\n  filter(gpa_hs <= 4.0) |>\n  filter(sat_hs <= 1600)\ndata_ivy <- data_hs |>\n  filter(gpa_hs > 3.6) |>\n  filter(sat_hs > 1400)\n\ncorr_val_before <- cor(data_hs$gpa_hs, data_hs$sat_hs)\ncorr_val_after <- cor(data_ivy$gpa_hs, data_ivy$sat_hs)\n\np1 <- data_hs |>\n  ggplot() + \n  geom_point(aes(x = gpa_hs, y = sat_hs),\n             color = \"gray75\") +\n  labs(title = \"High School Statistics\",\n       subtitle = paste0(\"correlation: r = \", round(corr_val_before, 4)),\n       caption = \"SML 201\",\n       x = \"High School GPA\", \n       y = \"SAT Score\") +\n  theme_minimal()\n\np2 <- data_hs |>\n  ggplot() + \n  geom_point(aes(x = gpa_hs, y = sat_hs),\n             color = \"gray75\") +\n  geom_point(aes(x = gpa_hs, y = sat_hs),\n             color = \"#FF671F\",\n             data = data_ivy,\n             size = 3) +\n  geom_vline(xintercept = 3.6, color = \"black\",\n             linewidth = 2, linetype = 2) +\n  geom_hline(yintercept = 1400, color = \"black\", \n             linewidth = 2, linetype = 2) +\n  labs(title = \"Selection Bias\",\n       subtitle = \"(subsetting)\",\n       caption = \"SML 201\",\n       x = \"High School GPA\", \n       y = \"SAT Score\") +\n  theme_minimal()\n\np3 <- data_ivy |>\n  ggplot() + \n  geom_point(aes(x = gpa_hs, y = sat_hs),\n             color = \"#FF671F\",\n             size = 3) +\n  labs(title = \"Princeton Students\",\n       subtitle = paste0(\"correlation: r = \", round(corr_val_after, 4)),\n       caption = \"SML 201\",\n       x = \"High School GPA\", \n       y = \"SAT Score\") +\n  theme_minimal()\n```\n:::\n\n\n:::::\n\n### Rizz\n\n::::: {.panel-tabset}\n\n#### dating pool\n\n![dating pool](bp0.png)\n\n* image source: [Cristóbal Alcázar](https://alkzar.cl/blog/2021-02-14-berkson-s-paradox/)\n\n#### subset 1\n\n![subset 1](bp1.png)\n\n* image source: [Cristóbal Alcázar](https://alkzar.cl/blog/2021-02-14-berkson-s-paradox/)\n\n#### subset 2\n\n![subset 2](bp2.png)\n\n::: {.callout-warning}\n## This is why everyone you date is a jerk!\n:::\n\n* image source: [Cristóbal Alcázar](https://alkzar.cl/blog/2021-02-14-berkson-s-paradox/)\n* as mentioned in a book by Carl T Bergstrom and Jevin D West\n\n:::::\n\n\n# Correlation Matrices\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  select_if(is.numeric) |>\n  cor(use = \"pairwise.complete.obs\") |>\n  corrplot.mixed(order = \"FPC\", upper = \"ellipse\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njudging_categories <- c(\"aroma\", \"flavor\", \"aftertaste\", \"acidity\", \"body\", \"balance\", \"uniformity\", \"clean_cup\", \"sweetness\")\n\ncoffee_df |>\n  select(any_of(c(judging_categories, \"total_cup_points\"))) |>\n  cor() |>\n  corrplot.mixed(order = \"FPC\", upper = \"ellipse\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n# Research Considerations\n\n::: {.callout-tip}\n## Correlation is not inherently bad!\n\nIf correlation is not causation, then ... ?\n\n* Humanities and life sciences tend to seek high correlation values\n\n    * hint at possible causation\n    \n* Physical sciences and engineering tend to seek low correlation\n\n    * dimensionality reduction\n\n* Causation? Seek out econometrics or graduate studies\n\n:::\n\n\n# Quantiles\n\nRecall that we can use `summary` on a numerical variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(coffee_df$total_cup_points)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   0.00   81.08   82.50   82.09   83.67   90.58 \n```\n\n\n:::\n:::\n\n\nThe `dplyr` way to compute quantiles includes\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  summarize(min = min(total_cup_points, na.rm = TRUE),\n            q25 = quantile(total_cup_points, 0.25, na.rm = TRUE),\n            q50 = quantile(total_cup_points, 0.50, na.rm = TRUE),\n            q75 = quantile(total_cup_points, 0.75, na.rm = TRUE),\n            max = max(total_cup_points, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 5\n    min   q25   q50   q75   max\n  <dbl> <dbl> <dbl> <dbl> <dbl>\n1     0  81.1  82.5  83.7  90.6\n```\n\n\n:::\n:::\n\n\nWe can verify that about 50% of the data are below the median value\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(coffee_df$total_cup_points < \n       median(coffee_df$total_cup_points))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4899178\n```\n\n\n:::\n:::\n\n\n\nWe can verify that about 75% of the data are indeed below that value for the 0.75 quantile (i.e. 75th percentile.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(coffee_df$total_cup_points < 83.67)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7490665\n```\n\n\n:::\n:::\n\n\nThe *interquartile range* is the 75th percentile minus the 25th percentile.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(coffee_df$total_cup_points)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   0.00   81.08   82.50   82.09   83.67   90.58 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIQR(coffee_df$total_cup_points, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.59\n```\n\n\n:::\n:::\n\n\n\n## Categorical Group\n\nThe `dplyr` code is easily adaptable to grouped data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  group_by(species) |>\n  summarize(min = min(total_cup_points, na.rm = TRUE),\n            q25 = quantile(total_cup_points, 0.25, na.rm = TRUE),\n            q50 = quantile(total_cup_points, 0.50, na.rm = TRUE),\n            q75 = quantile(total_cup_points, 0.75, na.rm = TRUE),\n            max = max(total_cup_points, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  species   min   q25   q50   q75   max\n  <chr>   <dbl> <dbl> <dbl> <dbl> <dbl>\n1 Arabica   0    81.2  82.5  83.7  90.6\n2 Robusta  73.8  80.2  81.5  82.5  83.8\n```\n\n\n:::\n:::\n\n\n\n## Histograms\n\n::::: {.panel-tabset}\n\n### plots\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n### code\n\n\n::: {.cell}\n\n```{.r .cell-code}\narabica <- coffee_df |>\n  filter(total_cup_points > 0) |>\n  filter(species == \"Arabica\")\n\nrobusta <- coffee_df |>\n  filter(total_cup_points > 0) |>\n  filter(species == \"Robusta\")\n\nq25 <- quantile(arabica$total_cup_points, 0.25, na.rm = TRUE)\nq50 <- quantile(arabica$total_cup_points, 0.50, na.rm = TRUE)\nq75 <- quantile(arabica$total_cup_points, 0.75, na.rm = TRUE)\nIQR <- q75 - q25\nbottom <- q25 - 1.5*IQR\ntop    <- q75 + 1.5*IQR\n\n# points of interest\nPOI <- c(bottom, q25, q50, q75, top)\n\np1 <- arabica |>\n  ggplot() +\n  geom_histogram(aes(x = total_cup_points),\n                 bins = 25,\n                 color = \"black\",\n                 fill = \"gray80\") +\n  geom_vline(xintercept = POI, color = \"red\",\n             linewidth = 2) +\n  labs(title = \"Arabica Coffee\",\n       subtitle = \"Distribution of Total Cup Points\",\n       caption = \"Source: Tidy Tuesday\") +\n  theme_minimal() +\n  xlim(55, 95)\n\nq25 <- quantile(robusta$total_cup_points, 0.25, na.rm = TRUE)\nq50 <- quantile(robusta$total_cup_points, 0.50, na.rm = TRUE)\nq75 <- quantile(robusta$total_cup_points, 0.75, na.rm = TRUE)\nIQR <- q75 - q25\nbottom <- q25 - 1.5*IQR\ntop    <- q75 + 1.5*IQR\n\n# points of interest\nPOI <- c(bottom, q25, q50, q75, top)\n\np2 <- robusta |>\n  ggplot() +\n  geom_histogram(aes(x = total_cup_points),\n                 bins = 25,\n                 color = \"black\",\n                 fill = \"gray80\") +\n  geom_vline(xintercept = POI, color = \"blue\",\n             linewidth = 2) +\n  labs(title = \"Robusta Coffee\",\n       subtitle = \"Distribution of Total Cup Points\",\n       caption = \"Source: Tidy Tuesday\") +\n  theme_minimal() +\n  xlim(55, 95)\n\n#| echo: false\n#| eval: true\n\np1 / p2 #patchwork\n```\n:::\n\n\n:::::\n\n\n\n\n# Boxplots\n\n::: {.callout-note}\n## Boxplots\n\nA *boxplot* is useful to graph a numerical variable (on the vertical axis) across a categorical variable (on the horizontal axis).\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  filter(total_cup_points > 0) |> #avoid one outlier\n  ggplot() +\n  geom_boxplot(aes(x = species, y = total_cup_points, color = species)) +\n  labs(title = \"Coffee Ratings\",\n       subtitle = \"Are these quantities different?\",\n       caption = \"Source: Coffee Quality Database\",\n       x = \"species\", y = \"total points\") +\n  scale_color_manual(values = c(\"red\",\"blue\")) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n## More than Two Groups\n\n:::: {.panel-tabset}\n\n### 1\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  filter(!is.na(processing_method)) |>\n  group_by(processing_method) |>\n  summarize(min = min(total_cup_points, na.rm = TRUE),\n            q25 = quantile(total_cup_points, 0.25, na.rm = TRUE),\n            q50 = quantile(total_cup_points, 0.50, na.rm = TRUE),\n            q75 = quantile(total_cup_points, 0.75, na.rm = TRUE),\n            max = max(total_cup_points, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 6\n  processing_method           min   q25   q50   q75   max\n  <chr>                     <dbl> <dbl> <dbl> <dbl> <dbl>\n1 Natural / Dry              67.9  81.2  82.8  83.8  89  \n2 Other                      63.1  80.8  81.8  83.0  84.7\n3 Pulped natural / honey     80.1  82.0  82.7  83.2  86.6\n4 Semi-washed / Semi-pulped  78.8  81.5  82.5  83.6  86.1\n5 Washed / Wet               59.8  81    82.4  83.5  90.6\n```\n\n\n:::\n:::\n\n\n### 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  filter(!is.na(processing_method)) |>\n  group_by(processing_method) |>\n  mutate(min_val = min(total_cup_points, na.rm = TRUE),\n         q25 = quantile(total_cup_points, 0.25, na.rm = TRUE),\n         q50 = quantile(total_cup_points, 0.50, na.rm = TRUE),\n         q75 = quantile(total_cup_points, 0.75, na.rm = TRUE),\n         max_val = max(total_cup_points, na.rm = TRUE)) |>\n  ungroup() |>\n  select(processing_method, min_val, q25, q50, q75, max_val) |>\n  distinct()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 6\n  processing_method         min_val   q25   q50   q75 max_val\n  <chr>                       <dbl> <dbl> <dbl> <dbl>   <dbl>\n1 Washed / Wet                 59.8  81    82.4  83.5    90.6\n2 Natural / Dry                67.9  81.2  82.8  83.8    89  \n3 Pulped natural / honey       80.1  82.0  82.7  83.2    86.6\n4 Semi-washed / Semi-pulped    78.8  81.5  82.5  83.6    86.1\n5 Other                        63.1  80.8  81.8  83.0    84.7\n```\n\n\n:::\n:::\n\n\n### Boxplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_df |>\n  filter(!is.na(processing_method)) |>\n  ggplot() +\n  geom_boxplot(aes(x = processing_method, y = total_cup_points,\n                   color = processing_method)) +\n  labs(title = \"Coffee Ratings\",\n       subtitle = \"Are these quantities different?\",\n       caption = \"Source: Coffee Quality Database\",\n       x = \"\", y = \"total points\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45),\n        legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n::::\n\n::: {.callout-warning}\n# DCP 3\n:::\n\n# Case Study: Implicit Bias\n\n::::: {.panel-tabset}\n\n## setup\n\nA couple of weeks ago, we rated a group of visuals (graphs).\n\n### A/B Testing\n\n* L01 saw one set of graphs\n* L02 saw a slightly different set of graphs\n\n\n::: {.cell}\n\n:::\n\n\n\n## 1\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/plot1A.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/plot1B.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\n\n## 2\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/plot2A.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/plot2B.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\n\n## 3\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/plot3A.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/plot3B.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n\n\n## 4\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/plot4A_3.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/plot4B_3.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\n\n## 5\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/plot6A.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/plot6B.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n\n\n## 6\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/Rapp_A.png)\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/Rapp_B.png)\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\n\n## 7\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n![L01](implicit_bias/grade_inflation_princeton.png)\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![L02](implicit_bias/grade_inflation_harvard.png)\t\t\n:::\n\n::::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](06_correlation_files/figure-html/unnamed-chunk-53-1.png){width=672}\n:::\n:::\n\n\n:::::\n\n\n\n\n\n\n\n\n# Quo Vadimus?\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n\n* Assignments (due Friday):\n\n    * Precept 3\n    * Introducting Gradescope\n\n* Project 1:\n    \n    * due: Feb 24\n    \n* Exam 1: March 5\n\n    * McDonnell A02\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n![Piracy and Global Warming are strongly and negatively correlated](pirates_global_warming.png)\n\n* image source: [Dr Sandy Dersham](https://donhillson.wordpress.com/2011/04/01/link-found-between-piracy-and-global-warming/)\n:::\n\n::::\n\n\n# Footnotes\n\n::: {.callout-note collapse=\"true\"}\n\n## (optional) Additional Resources\n\n* [vignette](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html) about `corrplot` by Taiyun Wei and Viliam Simko\n\n* [Simpsons Paradox song](https://www.youtube.com/watch?v=nGqzoqXZch0) by The Raf (to the tune of \"Blinding Lights\" by the Weeknd)\n\n* books about causation\n\n    * [The Effect](https://theeffectbook.net/index.html) by Nick Huntington-Klein\n    * [Causal Mixtape](https://mixtape.scunning.com/) by Scott Cunningham\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Session Info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.2 (2025-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n  LAPACK version 3.12.1\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    \n [5] purrr_1.1.0     readr_2.1.5     tidyr_1.3.1     tibble_3.3.0   \n [9] ggplot2_4.0.0   tidyverse_2.0.0 patchwork_1.3.1 gt_1.0.0       \n[13] ggsignif_0.6.4  corrplot_0.95  \n\nloaded via a namespace (and not attached):\n [1] sass_0.4.10        utf8_1.2.6         generics_0.1.4     xml2_1.3.8        \n [5] stringi_1.8.7      hms_1.1.3          digest_0.6.37      magrittr_2.0.3    \n [9] evaluate_1.0.4     grid_4.5.2         timechange_0.3.0   RColorBrewer_1.1-3\n[13] fastmap_1.2.0      jsonlite_2.0.0     scales_1.4.0       cli_3.6.5         \n[17] rlang_1.1.6        crayon_1.5.3       bit64_4.6.0-1      withr_3.0.2       \n[21] yaml_2.3.10        tools_4.5.2        parallel_4.5.2     tzdb_0.5.0        \n[25] vctrs_0.6.5        R6_2.6.1           lifecycle_1.0.4    htmlwidgets_1.6.4 \n[29] bit_4.6.0          vroom_1.6.5        pkgconfig_2.0.3    pillar_1.11.0     \n[33] gtable_0.3.6       glue_1.8.0         xfun_0.52          tidyselect_1.2.1  \n[37] rstudioapi_0.17.1  knitr_1.50         farver_2.1.2       htmltools_0.5.8.1 \n[41] labeling_0.4.3     rmarkdown_2.29     compiler_4.5.2     S7_0.2.0          \n```\n\n\n:::\n:::\n\n:::\n\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\n\t\n:::\n\n::: {.column width=\"10%\"}\n\t\n:::\n\n::: {.column width=\"45%\"}\n\n:::\n\n::::\n\n::::: {.panel-tabset}\n\n\n\n:::::",
    "supporting": [
      "06_correlation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}